<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Łukasz Rąbalski">
<meta name="dcterms.date" content="2022-11-27">

<title>Lukasz Rabalski blog - Monte Carlo Simulation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Lukasz Rabalski blog</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">Łukasz Rąbalski blog</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Rombix92?tab=repositories"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/%C5%82ukasz-r%C4%85balski-2892b8102/"><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Monte Carlo Simulation</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Łukasz Rąbalski </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 27, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="what-is-a-monte-carlo-simulation" class="level1">
<h1>What is a Monte Carlo Simulation?</h1>
<p>A Monte Carlo simulation is a type of computational algorithm that estimates the probability of occurrence of an undeterminable event due to the involvement of random variables. The algorithm relies on repeated random sampling in an attempt to determine the probability. This means simulating an event with random inputs a large number of times to obtain your estimation. You can determine other factors as well, and we will see that in the example. Monte Carlo simulations can be utilized in a broad range of fields spanning from economics, gambling, engineering, energy, and anything in-between. So, no matter what career field you are in, it’s an excellent thing to know about.</p>
<p>#The Dice Game</p>
<p>Our simple game will involve two six-sided dice. In order to win, the player needs to roll the same number on both dice. A six-sided die has six possible outcomes (1, 2, 3, 4, 5, and 6). With two dice, there is now 36 possible outcomes (1 and 1, 1 and 2, 1 and 3, etc., or 6 x 6 = 36 possibilities). In this game, the house has more opportunities to win (30 outcomes vs.&nbsp;the player’s 6 outcomes), meaning the house has the quite the advantage.</p>
<p>Let’s say our player starts with a balance of $1,000 and is prepared to lose it all, so they bet $1 on every roll (meaning both dice are rolled) and decide to play 1,000 rolls. Because the house is so generous, they offer to payout 4 times the player’s bet when the player wins. For example, if the player wins the first roll, their balance increases by $4, and they end the round with a balance of $1,004. If they miraculously went on a 1,000 roll win-streak, they could go home with $5,000. If they lost every round, they could go home with nothing. Not a bad risk-reward ratio… or maybe it is.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Importing Packages</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="im">import</span> random</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="dice-roll-function" class="level2">
<h2 class="anchored" data-anchor-id="dice-roll-function">Dice Roll Function</h2>
<p>Let’s define a function that will randomize an integer from 1 to 6 for both dice (simulating a roll). The function will also compare the two dice to see if they are the same. The function will return a Boolean variable, same_num, to store if the rolls are the same or not. We will use this value later to determine actions in our code.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Creating Roll Dice Function</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw">def</span> roll_dice():</span>
<span id="cb2-3"><a href="#cb2-3"></a>    die_1 <span class="op">=</span> random.randint(<span class="dv">1</span>, <span class="dv">6</span>)</span>
<span id="cb2-4"><a href="#cb2-4"></a>    die_2 <span class="op">=</span> random.randint(<span class="dv">1</span>, <span class="dv">6</span>)</span>
<span id="cb2-5"><a href="#cb2-5"></a>    <span class="co"># Determining if the dice are the same number</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>    <span class="cf">if</span> die_1 <span class="op">==</span> die_2:</span>
<span id="cb2-7"><a href="#cb2-7"></a>        same_num <span class="op">=</span> <span class="va">True</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>    <span class="cf">else</span>:</span>
<span id="cb2-9"><a href="#cb2-9"></a>        same_num <span class="op">=</span> <span class="va">False</span></span>
<span id="cb2-10"><a href="#cb2-10"></a>    <span class="cf">return</span> same_num</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>These are initialized as lists and will be updated at the end of each game.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Inputs</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>num_simulations <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>max_num_rolls <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>bet <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co"># Tracking</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>win_probability <span class="op">=</span> []</span>
<span id="cb3-8"><a href="#cb3-8"></a>end_balance <span class="op">=</span> []</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Creating Figure for Simulation Balances</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>fig <span class="op">=</span> plt.figure()</span>
<span id="cb4-3"><a href="#cb4-3"></a>plt.title(<span class="st">"Monte Carlo Dice Game ["</span> <span class="op">+</span> <span class="bu">str</span>(num_simulations) <span class="op">+</span> <span class="st">"simulations]"</span>)</span>
<span id="cb4-4"><a href="#cb4-4"></a>plt.xlabel(<span class="st">"Roll Number"</span>)</span>
<span id="cb4-5"><a href="#cb4-5"></a>plt.ylabel(<span class="st">"Balance [$]"</span>)</span>
<span id="cb4-6"><a href="#cb4-6"></a>plt.xlim([<span class="dv">0</span>, max_num_rolls])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(0.0, 1000.0)</code></pre>
</div>
</div>
<p>Once the number of rolls hits 1,000, we can calculate the player’s win probability as the number of wins divided by the total number of rolls. We can also store the ending balance for the completed game in the tracking variable end_balance. Finally, we can plot the num_rolls and balance variables to add a line to the figure we defined earlier.</p>
</section>
<section id="monte-carlo-simulation" class="level2">
<h2 class="anchored" data-anchor-id="monte-carlo-simulation">Monte Carlo Simulation</h2>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># For loop to run for the number of simulations desired</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_simulations):</span>
<span id="cb6-3"><a href="#cb6-3"></a>    balance <span class="op">=</span> [<span class="dv">1000</span>]</span>
<span id="cb6-4"><a href="#cb6-4"></a>    num_rolls <span class="op">=</span> [<span class="dv">0</span>]</span>
<span id="cb6-5"><a href="#cb6-5"></a>    num_wins <span class="op">=</span> <span class="dv">0</span>    <span class="co"># Run until the player has rolled 1,000 times</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>    <span class="cf">while</span> num_rolls[<span class="op">-</span><span class="dv">1</span>] <span class="op">&lt;</span> max_num_rolls:</span>
<span id="cb6-7"><a href="#cb6-7"></a>        same <span class="op">=</span> roll_dice()        <span class="co"># Result if the dice are the same number</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>        <span class="cf">if</span> same:</span>
<span id="cb6-9"><a href="#cb6-9"></a>            balance.append(balance[<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> bet)</span>
<span id="cb6-10"><a href="#cb6-10"></a>            num_wins <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb6-11"><a href="#cb6-11"></a>        <span class="co"># Result if the dice are different numbers</span></span>
<span id="cb6-12"><a href="#cb6-12"></a>        <span class="cf">else</span>:</span>
<span id="cb6-13"><a href="#cb6-13"></a>            balance.append(balance[<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> bet)</span>
<span id="cb6-14"><a href="#cb6-14"></a>        num_rolls.append(num_rolls[<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> <span class="dv">1</span>)<span class="co"># Store tracking variables and add line to figure</span></span>
<span id="cb6-15"><a href="#cb6-15"></a>    win_probability.append(num_wins<span class="op">/</span>num_rolls[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb6-16"><a href="#cb6-16"></a>    end_balance.append(balance[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb6-17"><a href="#cb6-17"></a>    plt.plot(num_rolls, balance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The last step is displaying meaningful data from our tracking variables. We can display our figure (shown below) that we created in our for loop. Also, we can calculate and display (shown below) our overall win probability and ending balance by averaging our win_probability and end_balance lists.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Averaging win probability and end balance</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>overall_win_probability <span class="op">=</span> <span class="bu">sum</span>(win_probability)<span class="op">/</span><span class="bu">len</span>(win_probability)</span>
<span id="cb7-3"><a href="#cb7-3"></a>overall_end_balance <span class="op">=</span> <span class="bu">sum</span>(end_balance)<span class="op">/</span><span class="bu">len</span>(end_balance)<span class="co"># Displaying the averages</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="bu">print</span>(<span class="st">"Average win probability after "</span> <span class="op">+</span> <span class="bu">str</span>(num_simulations) <span class="op">+</span> <span class="st">"runs: "</span> <span class="op">+</span> <span class="bu">str</span>(overall_win_probability))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Average win probability after 100runs: 0.16773999999999997</code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="bu">print</span>(<span class="st">"Average ending balance after "</span> <span class="op">+</span> <span class="bu">str</span>(num_simulations) <span class="op">+</span> <span class="st">"runs: $"</span> <span class="op">+</span> <span class="bu">str</span>(overall_end_balance))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Average ending balance after 100runs: $838.7</code></pre>
</div>
</div>
</section>
<section id="analyzing-results" class="level2">
<h2 class="anchored" data-anchor-id="analyzing-results">Analyzing Results</h2>
<p>The most important part of any Monte Carlo simulation (or any analysis for that matter) is drawing conclusions from the results. From our figure, we can determine that the player rarely makes a profit after 1,000 rolls. In fact, the average ending balance of our 10,000 simulations is $833.66 (your results may be slightly different due to randomization). So, even though the house was “generous” in paying out 4 times our bet when the player won, the house still came out on top.</p>
<p>We also notice that our win probability is about 0.1667, or approximately 1/6. Let’s think about why that might be. Returning back to one of the earlier paragraphs, we noted that the player had 6 outcomes in which they could win. We also noted there are 36 possible rolls. Using these two numbers, we would expect that the player would win 6 out of 36 rolls, or 1/6 rolls, which matches our Monte Carlo prediction. Pretty cool!</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb11" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb11-1"><a href="#cb11-1"></a><span class="co">---</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="an">title:</span><span class="co"> "Monte Carlo Simulation"</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="an">author:</span><span class="co"> 'Łukasz Rąbalski'</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="an">date:</span><span class="co"> '2022-11-27'</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="an">categories:</span><span class="co"> []</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="an">tags:</span><span class="co"> []</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="an">editor:</span><span class="co"> source</span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co">fig.height: 4</span></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="co">out.width: '100%'</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="an">include:</span><span class="co"> true  #prevents code and results from appearing in the finished file. R Markdown still runs the code in the chunk, and the results can be used by other chunks.</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="an">echo:</span><span class="co"> true  #echo = FALSE prevents code, but not the results from appearing in the finished file. This is a useful way to embed figures.</span></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="an">warning:</span><span class="co"> false</span></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="an">message:</span><span class="co"> false</span></span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="an">collapse:</span><span class="co"> true</span></span>
<span id="cb11-15"><a href="#cb11-15"></a><span class="an">error:</span><span class="co"> true</span></span>
<span id="cb11-16"><a href="#cb11-16"></a><span class="co"># format:</span></span>
<span id="cb11-17"><a href="#cb11-17"></a><span class="co">#   html:</span></span>
<span id="cb11-18"><a href="#cb11-18"></a><span class="co">#     toc: true</span></span>
<span id="cb11-19"><a href="#cb11-19"></a><span class="co">#     code-fold: true</span></span>
<span id="cb11-20"><a href="#cb11-20"></a><span class="co">---</span></span>
<span id="cb11-23"><a href="#cb11-23"></a><span class="in">```{r}</span></span>
<span id="cb11-24"><a href="#cb11-24"></a><span class="co">#| include: false</span></span>
<span id="cb11-25"><a href="#cb11-25"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb11-26"><a href="#cb11-26"></a>myenvs<span class="ot">=</span><span class="fu">conda_list</span>()</span>
<span id="cb11-27"><a href="#cb11-27"></a>envname<span class="ot">=</span>myenvs<span class="sc">$</span>name[<span class="dv">3</span>]</span>
<span id="cb11-28"><a href="#cb11-28"></a><span class="fu">use_condaenv</span>(envname, <span class="at">required =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-29"><a href="#cb11-29"></a></span>
<span id="cb11-30"><a href="#cb11-30"></a><span class="fu">Sys.setenv</span>(<span class="at">RETICULATE_PYTHON =</span> <span class="st">"/Users/lrabalski1/miniforge3/envs/everyday_use/bin/python"</span>)</span>
<span id="cb11-31"><a href="#cb11-31"></a>reticulate<span class="sc">::</span><span class="fu">py_config</span>()</span>
<span id="cb11-32"><a href="#cb11-32"></a><span class="in">```</span></span>
<span id="cb11-33"><a href="#cb11-33"></a></span>
<span id="cb11-34"><a href="#cb11-34"></a><span class="fu"># What is a Monte Carlo Simulation?</span></span>
<span id="cb11-35"><a href="#cb11-35"></a></span>
<span id="cb11-36"><a href="#cb11-36"></a>A Monte Carlo simulation is a type of computational algorithm that estimates the probability of occurrence of an undeterminable event due to the involvement of random variables. The algorithm relies on repeated random sampling in an attempt to determine the probability. This means simulating an event with random inputs a large number of times to obtain your estimation. You can determine other factors as well, and we will see that in the example. Monte Carlo simulations can be utilized in a broad range of fields spanning from economics, gambling, engineering, energy, and anything in-between. So, no matter what career field you are in, it’s an excellent thing to know about.</span>
<span id="cb11-37"><a href="#cb11-37"></a></span>
<span id="cb11-38"><a href="#cb11-38"></a>#The Dice Game</span>
<span id="cb11-39"><a href="#cb11-39"></a></span>
<span id="cb11-40"><a href="#cb11-40"></a>Our simple game will involve two six-sided dice. In order to win, the player needs to roll the same number on both dice. A six-sided die has six possible outcomes (1, 2, 3, 4, 5, and 6). With two dice, there is now 36 possible outcomes (1 and 1, 1 and 2, 1 and 3, etc., or 6 x 6 = 36 possibilities). In this game, the house has more opportunities to win (30 outcomes vs. the player’s 6 outcomes), meaning the house has the quite the advantage.</span>
<span id="cb11-41"><a href="#cb11-41"></a></span>
<span id="cb11-42"><a href="#cb11-42"></a>Let’s say our player starts with a balance of $1,000 and is prepared to lose it all, so they bet $1 on every roll (meaning both dice are rolled) and decide to play 1,000 rolls. Because the house is so generous, they offer to payout 4 times the player’s bet when the player wins. For example, if the player wins the first roll, their balance increases by $4, and they end the round with a balance of $1,004. If they miraculously went on a 1,000 roll win-streak, they could go home with $5,000. If they lost every round, they could go home with nothing. Not a bad risk-reward ratio… or maybe it is.</span>
<span id="cb11-43"><a href="#cb11-43"></a></span>
<span id="cb11-46"><a href="#cb11-46"></a><span class="in">```{python}</span></span>
<span id="cb11-47"><a href="#cb11-47"></a><span class="co"># Importing Packages</span></span>
<span id="cb11-48"><a href="#cb11-48"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb11-49"><a href="#cb11-49"></a><span class="im">import</span> random</span>
<span id="cb11-50"><a href="#cb11-50"></a><span class="in">```</span></span>
<span id="cb11-51"><a href="#cb11-51"></a></span>
<span id="cb11-52"><a href="#cb11-52"></a><span class="fu">## Dice Roll Function</span></span>
<span id="cb11-53"><a href="#cb11-53"></a></span>
<span id="cb11-54"><a href="#cb11-54"></a>Let's define a function that will randomize an integer from 1 to 6 for both dice (simulating a roll). The function will also compare the two dice to see if they are the same. The function will return a Boolean variable, same_num, to store if the rolls are the same or not. We will use this value later to determine actions in our code.</span>
<span id="cb11-55"><a href="#cb11-55"></a></span>
<span id="cb11-58"><a href="#cb11-58"></a><span class="in">```{python}</span></span>
<span id="cb11-59"><a href="#cb11-59"></a><span class="co"># Creating Roll Dice Function</span></span>
<span id="cb11-60"><a href="#cb11-60"></a><span class="kw">def</span> roll_dice():</span>
<span id="cb11-61"><a href="#cb11-61"></a>    die_1 <span class="op">=</span> random.randint(<span class="dv">1</span>, <span class="dv">6</span>)</span>
<span id="cb11-62"><a href="#cb11-62"></a>    die_2 <span class="op">=</span> random.randint(<span class="dv">1</span>, <span class="dv">6</span>)</span>
<span id="cb11-63"><a href="#cb11-63"></a>    <span class="co"># Determining if the dice are the same number</span></span>
<span id="cb11-64"><a href="#cb11-64"></a>    <span class="cf">if</span> die_1 <span class="op">==</span> die_2:</span>
<span id="cb11-65"><a href="#cb11-65"></a>        same_num <span class="op">=</span> <span class="va">True</span></span>
<span id="cb11-66"><a href="#cb11-66"></a>    <span class="cf">else</span>:</span>
<span id="cb11-67"><a href="#cb11-67"></a>        same_num <span class="op">=</span> <span class="va">False</span></span>
<span id="cb11-68"><a href="#cb11-68"></a>    <span class="cf">return</span> same_num</span>
<span id="cb11-69"><a href="#cb11-69"></a></span>
<span id="cb11-70"><a href="#cb11-70"></a><span class="in">```</span></span>
<span id="cb11-71"><a href="#cb11-71"></a></span>
<span id="cb11-72"><a href="#cb11-72"></a>These are initialized as lists and will be updated at the end of each game.</span>
<span id="cb11-75"><a href="#cb11-75"></a><span class="in">```{python}</span></span>
<span id="cb11-76"><a href="#cb11-76"></a><span class="co"># Inputs</span></span>
<span id="cb11-77"><a href="#cb11-77"></a>num_simulations <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb11-78"><a href="#cb11-78"></a>max_num_rolls <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb11-79"><a href="#cb11-79"></a>bet <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb11-80"><a href="#cb11-80"></a></span>
<span id="cb11-81"><a href="#cb11-81"></a><span class="co"># Tracking</span></span>
<span id="cb11-82"><a href="#cb11-82"></a>win_probability <span class="op">=</span> []</span>
<span id="cb11-83"><a href="#cb11-83"></a>end_balance <span class="op">=</span> []</span>
<span id="cb11-84"><a href="#cb11-84"></a><span class="in">```</span></span>
<span id="cb11-85"><a href="#cb11-85"></a></span>
<span id="cb11-88"><a href="#cb11-88"></a><span class="in">```{python}</span></span>
<span id="cb11-89"><a href="#cb11-89"></a><span class="co"># Creating Figure for Simulation Balances</span></span>
<span id="cb11-90"><a href="#cb11-90"></a>fig <span class="op">=</span> plt.figure()</span>
<span id="cb11-91"><a href="#cb11-91"></a>plt.title(<span class="st">"Monte Carlo Dice Game ["</span> <span class="op">+</span> <span class="bu">str</span>(num_simulations) <span class="op">+</span> <span class="st">"simulations]"</span>)</span>
<span id="cb11-92"><a href="#cb11-92"></a>plt.xlabel(<span class="st">"Roll Number"</span>)</span>
<span id="cb11-93"><a href="#cb11-93"></a>plt.ylabel(<span class="st">"Balance [$]"</span>)</span>
<span id="cb11-94"><a href="#cb11-94"></a>plt.xlim([<span class="dv">0</span>, max_num_rolls])</span>
<span id="cb11-95"><a href="#cb11-95"></a><span class="in">```</span></span>
<span id="cb11-96"><a href="#cb11-96"></a></span>
<span id="cb11-97"><a href="#cb11-97"></a>Once the number of rolls hits 1,000, we can calculate the player’s win probability as the number of wins divided by the total number of rolls. We can also store the ending balance for the completed game in the tracking variable end_balance. Finally, we can plot the num_rolls and balance variables to add a line to the figure we defined earlier.</span>
<span id="cb11-98"><a href="#cb11-98"></a></span>
<span id="cb11-99"><a href="#cb11-99"></a><span class="fu">## Monte Carlo Simulation</span></span>
<span id="cb11-100"><a href="#cb11-100"></a></span>
<span id="cb11-103"><a href="#cb11-103"></a><span class="in">```{python}</span></span>
<span id="cb11-104"><a href="#cb11-104"></a><span class="co"># For loop to run for the number of simulations desired</span></span>
<span id="cb11-105"><a href="#cb11-105"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_simulations):</span>
<span id="cb11-106"><a href="#cb11-106"></a>    balance <span class="op">=</span> [<span class="dv">1000</span>]</span>
<span id="cb11-107"><a href="#cb11-107"></a>    num_rolls <span class="op">=</span> [<span class="dv">0</span>]</span>
<span id="cb11-108"><a href="#cb11-108"></a>    num_wins <span class="op">=</span> <span class="dv">0</span>    <span class="co"># Run until the player has rolled 1,000 times</span></span>
<span id="cb11-109"><a href="#cb11-109"></a>    <span class="cf">while</span> num_rolls[<span class="op">-</span><span class="dv">1</span>] <span class="op">&lt;</span> max_num_rolls:</span>
<span id="cb11-110"><a href="#cb11-110"></a>        same <span class="op">=</span> roll_dice()        <span class="co"># Result if the dice are the same number</span></span>
<span id="cb11-111"><a href="#cb11-111"></a>        <span class="cf">if</span> same:</span>
<span id="cb11-112"><a href="#cb11-112"></a>            balance.append(balance[<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> bet)</span>
<span id="cb11-113"><a href="#cb11-113"></a>            num_wins <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb11-114"><a href="#cb11-114"></a>        <span class="co"># Result if the dice are different numbers</span></span>
<span id="cb11-115"><a href="#cb11-115"></a>        <span class="cf">else</span>:</span>
<span id="cb11-116"><a href="#cb11-116"></a>            balance.append(balance[<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> bet)</span>
<span id="cb11-117"><a href="#cb11-117"></a>        num_rolls.append(num_rolls[<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> <span class="dv">1</span>)<span class="co"># Store tracking variables and add line to figure</span></span>
<span id="cb11-118"><a href="#cb11-118"></a>    win_probability.append(num_wins<span class="op">/</span>num_rolls[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb11-119"><a href="#cb11-119"></a>    end_balance.append(balance[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb11-120"><a href="#cb11-120"></a>    plt.plot(num_rolls, balance)</span>
<span id="cb11-121"><a href="#cb11-121"></a></span>
<span id="cb11-122"><a href="#cb11-122"></a><span class="in">```</span></span>
<span id="cb11-123"><a href="#cb11-123"></a></span>
<span id="cb11-124"><a href="#cb11-124"></a>The last step is displaying meaningful data from our tracking variables. We can display our figure (shown below) that we created in our for loop. Also, we can calculate and display (shown below) our overall win probability and ending balance by averaging our win_probability and end_balance lists.</span>
<span id="cb11-125"><a href="#cb11-125"></a></span>
<span id="cb11-128"><a href="#cb11-128"></a><span class="in">```{python}</span></span>
<span id="cb11-129"><a href="#cb11-129"></a><span class="co"># Averaging win probability and end balance</span></span>
<span id="cb11-130"><a href="#cb11-130"></a>overall_win_probability <span class="op">=</span> <span class="bu">sum</span>(win_probability)<span class="op">/</span><span class="bu">len</span>(win_probability)</span>
<span id="cb11-131"><a href="#cb11-131"></a>overall_end_balance <span class="op">=</span> <span class="bu">sum</span>(end_balance)<span class="op">/</span><span class="bu">len</span>(end_balance)<span class="co"># Displaying the averages</span></span>
<span id="cb11-132"><a href="#cb11-132"></a><span class="bu">print</span>(<span class="st">"Average win probability after "</span> <span class="op">+</span> <span class="bu">str</span>(num_simulations) <span class="op">+</span> <span class="st">"runs: "</span> <span class="op">+</span> <span class="bu">str</span>(overall_win_probability))</span>
<span id="cb11-133"><a href="#cb11-133"></a><span class="bu">print</span>(<span class="st">"Average ending balance after "</span> <span class="op">+</span> <span class="bu">str</span>(num_simulations) <span class="op">+</span> <span class="st">"runs: $"</span> <span class="op">+</span> <span class="bu">str</span>(overall_end_balance))</span>
<span id="cb11-134"><a href="#cb11-134"></a><span class="in">```</span></span>
<span id="cb11-135"><a href="#cb11-135"></a></span>
<span id="cb11-136"><a href="#cb11-136"></a><span class="fu">## Analyzing Results</span></span>
<span id="cb11-137"><a href="#cb11-137"></a></span>
<span id="cb11-138"><a href="#cb11-138"></a>The most important part of any Monte Carlo simulation (or any analysis for that matter) is drawing conclusions from the results. From our figure, we can determine that the player rarely makes a profit after 1,000 rolls. In fact, the average ending balance of our 10,000 simulations is $833.66 (your results may be slightly different due to randomization). So, even though the house was “generous” in paying out 4 times our bet when the player won, the house still came out on top.</span>
<span id="cb11-139"><a href="#cb11-139"></a></span>
<span id="cb11-140"><a href="#cb11-140"></a>We also notice that our win probability is about 0.1667, or approximately 1/6. Let’s think about why that might be. Returning back to one of the earlier paragraphs, we noted that the player had 6 outcomes in which they could win. We also noted there are 36 possible rolls. Using these two numbers, we would expect that the player would win 6 out of 36 rolls, or 1/6 rolls, which matches our Monte Carlo prediction. Pretty cool!</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>